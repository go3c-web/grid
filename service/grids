二、工单管理（实体服务）

关键词
1.组织（orgid）： 本系统一次部署覆盖的范围，比如一个省网、一个视网，组织有最高的权限范围
2.行政大区（district）：  一般是大的行政区划，比如杭州滨江区，某某县都可以视为一个大区
3.行政小区（subdistrict）：  一般是大的行政区划下面的比如某某街道（浦沿），某某镇，某某县城区（一般是）
4.分区（area）：    非行政区划， 一类相邻小区的集合称为分区，比如以XX路以南，XX路以北，XX路以西，XX路以东构成一个分区。分区在地理上是否允许重叠？。 对应的可能为
5.小分区（subarea）: 网格最小的区域划分属性，比如某个街道，某个居民小区，某幢办公楼等。
6.网格（grid）：      多个服务小区的组合称为网格，网格可以顶部划分并指定服务区域（物理网格），也可以自己选择自己的服务区域（虚拟网格）。网格可以同时具备物理与虚拟网格属性。网格的分区属性可以为一个列表，可以选择district, subdistrict, area, subarea任意一个。
7.网格分组（group）： 网格的标签属性，多个网格组成一个网格分组，一个网格可以属于多个分组，一个分组可以有多个网格。为可选，需要自己琢磨网格分组的意义究竟何在？
8.工单编号(workcard_id)： 工单编号的规范需要定义，根据工单编号规范自动生成。
9.工单优先级（priority）   ：根据工单优先级算法自动计算，也可以人工干预。0~5, 1最高，5最低，0置顶。同一优先级的工单，根据优先级设置时间先后排序。
10.工单派发状态（dispatch）：new(新工单), grabing（抢单模式派发）, assigning（指定模式派发）      由派单服务维护。定义工单派发过程的各种状态
11.工单派发反馈状态（feedback）： rejected（派发被拒绝）, assigned（成功派发）, grabed（被抢）  由派单服务维护。定义工单派发过程的各种状态
12.工单执行状态（process）：grabing（可抢工单）, reserving(待预约)，reserved（已预约）,installed（已安装）。由工单服务接口维护状态？。
13.工单评价状态(comment)：commented（已评价）, commenting(待评价), 工单评价接口负责本状态更新。
14.工单发起方（startup）：  order(订单系统), editor（人工编辑），CRM（客服发起）
15.工单派发类型（when）：  presentable(即时派发), bookable(预约派发),
16.工单派发模式（mode）：    {grabe(抢单模式), assign（指定模式）} (派发到大区的算哪种？)
17.工单派发目标粒度（granularity）：{ area(大区)，group（网格分组）， grid（网格）， worker（装维人员）}
18.网格人员工单来源（where）： { assigned(强派工单)， grabed（抢到工单）， forwarded(转入工单) }
19.网格人员工单处理（action）： { “forwarding”(转出)，"canceled"（取消工单），process（处理中工单） }
20.网格人员工作状态(working)：{online|offline}
21.工单订户评价状态（comment）： （用户评价与网格对用户评价属于2个不同维度，不适合用工单状态描述，估计需要独立的评价体系处理）

关键process
1.派单取消过程：派单成功后的工单被取消的过程
2.派单作废过程：（取消与作废有区别？）
3.工单派发过程：工单产生后到被装维人员接受并反馈的过程
4.工单执行过程：工单被装维人员接受到执行完成过程
5.工单评价过程：工单被执行完成到用户评价过程
6.工单取消过程：工单产生后到被相关人员取消的过程
7.工单作废过程：（取消与作废有区别？）

关键算法
1.工单生成算法：输入订单信息后生成,需要哪些信息？
2.工单优先级策略：
  2.1派单及时性属性（订单里属性）
  2.2订单分值？？：对订单进行重要性区分(具体参考对订单的处理)。
  2.3客户等级 （具体参考会员等级）
  2.4客户时间槽
3.工单派发路径算法：最小匹配反向优先原则
  3.1优先直接匹配网格人员
  3.2其次匹配网格，并根据配置从网格选择人员列表，或者可配置的网格内抢单
  3.3其次匹配网格组，并根据配置从网格选择人员列表，或者可配置的网格内抢单
  3.4其次匹配大区，并根据配置从网格选择人员列表，或者可配置的网格内抢单
  3.5其次根据配置派发指定目标：比如全网抢单（数据量过大），专人处理，全部大区，随机派发等等。
4.工单重派算法：
  4.1已经派发出去一定时间内没有反馈的已派工单，需要先派单作废，每个客户端自动处理派单作废信息，并将未接受工单作废。
5.工单网格人员匹配算法：根据工单号获取可用的网格人员，可以为1个或者多个，至于返回多少个的逻辑属于网格人员根据工单信息的获取逻辑。
  5.1指定人员匹配（硬性匹配）
  5.2可到达地理位置匹配（硬性匹配）
  5.3可用服务时间匹配（此步骤可以获取一个可用人员列表，并通过下面的人员属性进行filter）（硬性匹配）
  5.4装维人员等级排序匹配 (来自绩效？)（软性匹配）
  5.5装维人员服务意愿匹配 (来自意愿) （软性匹配）
  5.6工单所属区域的指定网格组、网格、网格人员还是外部动态加入的
  


 网格搜索

搜索大区                      GET     areas/{id=area}
搜索网格分组                GET     groups/{id=area&group}
搜索网格                      GET     grids/{id=area&group&grid}
搜索网格人员                GET     workers/{id=area&group&grid&name}
搜索工单                      GET     workcards/{id=area&group&grid&workcard id&datetime}
